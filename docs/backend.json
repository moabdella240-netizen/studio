{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AnAi Hub application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "preferredLanguage": {
          "type": "string",
          "description": "The user's preferred language (Tigrinya or Saho)."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "preferredLanguage"
      ]
    },
    "LearningModule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningModule",
      "type": "object",
      "description": "Represents a personalized learning module.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the learning module."
        },
        "title": {
          "type": "string",
          "description": "The title of the learning module."
        },
        "description": {
          "type": "string",
          "description": "A description of the learning module's content."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LearningModule)"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "userId"
      ]
    },
    "EducationalResource": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EducationalResource",
      "type": "object",
      "description": "Represents an educational resource in the database.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the educational resource."
        },
        "title": {
          "type": "string",
          "description": "The title of the educational resource."
        },
        "url": {
          "type": "string",
          "description": "The URL of the educational resource.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "The category of the educational resource."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the educational resource.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "url",
        "category",
        "tags"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task managed by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        },
        "dueDate": {
          "type": "string",
          "description": "The due date of the task.",
          "format": "date-time"
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the task is completed."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task)"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "dueDate",
        "completed",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/learningModules/{learningModuleId}",
        "definition": {
          "entityName": "LearningModule",
          "schema": {
            "$ref": "#/backend/entities/LearningModule"
          },
          "description": "Stores learning modules specific to a user. Path-based ownership guarantees that only the user can manage their own learning modules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "learningModuleId",
              "description": "The unique identifier of the learning module."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks specific to a user. Path-based ownership ensures only the user can manage their own tasks.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            }
          ]
        }
      },
      {
        "path": "/educationalResources/{educationalResourceId}",
        "definition": {
          "entityName": "EducationalResource",
          "schema": {
            "$ref": "#/backend/entities/EducationalResource"
          },
          "description": "Stores global educational resources. No public read/write access is enabled, access is role-based and should be handled by admin. The resources themselves are globally available for all users of the app to utilize.",
          "params": [
            {
              "name": "educationalResourceId",
              "description": "The unique identifier of the educational resource."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. Authorization independence is achieved through denormalization, avoiding `get()` calls in security rules. Structural segregation ensures that each collection has a homogeneous security posture. Access modeling uses consistent patterns for authorization (Path-Based ownership). Invariants are maintained by enforcing ownership, timestamps, and data consistency.\n\nUser data is stored under `/users/{userId}` for private data, ensuring that each user can only access their own data. Learning Modules and Tasks are stored as subcollections under the user's document to represent the one-to-many relationship, using path-based ownership. Educational Resources are stored in a top-level collection, as they are global and not user-specific. Because these resources are global, no read/write access is given to the general public. This is in line with the structural segregation principle to maintain a homogeneous security posture for each collection.\n\nThis structure supports QAPs by using path-based ownership for user-specific data. This allows for secure list operations within each user's data scope. Global data (educational resources) are secured at the collection level, enforcing role-based access control."
  }
}